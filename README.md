# Google C++ Style Fixer (VS Code Extension)

**Creator**: Shachenkova Kate, ITMO Universty (M3101)

This Visual Studio Code extension helps you keep your C and C++ code close to the
[Google C++ Style Guide](https://google.github.io/styleguide/cppguide.html) while still
respecting your own clang-format / clang-tidy configuration.

It is designed to be very explicit and predictable:
you press a command – it changes files **once**, and then stops.

---

## 1. What this extension does

The extension provides **two commands**:

1. **`Fix C++ Google Style in Workspace without hard renaming`**  
   Command ID: `googleStyleFixer.fixWorkspace`

   - Runs `clang-tidy` with `-fix` on **all C/C++ files** in the workspace that match configured glob patterns.
   - Automatically **adds missing standard library `#include <...>` directives** for common `std::...` usages
     (`std::cout`, `std::cerr`, `std::string`, `std::vector`, etc.) and inserts them into the block of
     system includes *before* local includes.
   - Runs `clang-format` on those files.
   - **Does _not_ change identifier naming.**  
     All readability-identifier-naming renames are disabled for this command.

2. **`Fix C++ Google Style in Current File`**  
   Command ID: `googleStyleFixer.fixAndRenameCurrentFile`

   For **the active file only**, it does three steps:

   1. Runs `clang-tidy` **without `-fix`** to collect
      `readability-identifier-naming` warnings.
   2. For each naming violation in this file it:
      - computes a new identifier according to a Google-like convention;
      - calls VS Code’s built-in *Rename Symbol* provider
        (`vscode.executeDocumentRenameProvider`) at that position;
      - this is the same as using F2 / Rename Symbol, so **all uses across the
        project are updated safely by the language server**.
   3. After that, it runs `clang-tidy -fix` again with identifier renaming
      disabled, and finally runs `clang-format` on the file.

Summary:

- **Workspace command** → style fixes + automatic standard includes, **no naming changes**.  
- **Current file command** → renames identifiers in a style-safe way and then
  applies style fixes.

All tab/indent settings are controlled by your `.clang-format`. In the sample
configuration we use tabs with a visual width of 4 spaces, and make sure
single-line `if`/`for`/`while` statements always get braces.

---

## 2. Requirements

You need:

1. **Visual Studio Code** 1.90.0 or newer.
2. **Node.js** and **npm** (only if you build the extension from source).
3. **clang-tidy** and **clang-format**, installed and available in your PATH or
   configured via extension settings.

The extension expects *C/C++* files and works best when your project has a
`compile_commands.json` (for example, generated by CMake).

### 2.1. Installing clang-tidy / clang-format

#### Linux

Use your distribution’s package manager. Examples:

- **Ubuntu / Debian**:

  ```bash
  sudo apt update
  sudo apt install clang clang-tidy clang-format
  ```

- **Arch / Manjaro**:

  ```bash
  sudo pacman -S clang clang-tools-extra
  ```

- **Fedora**:

  ```bash
  sudo dnf install clang clang-tools-extra
  ```

After installation, check:

```bash
clang-tidy --version
clang-format --version
```

#### macOS

Using Homebrew:

```bash
brew install llvm
```

This installs tools under `/opt/homebrew/opt/llvm/bin` (Apple Silicon) or
`/usr/local/opt/llvm/bin` (Intel). You can either:

- add that directory to your PATH, or  
- configure the extension to use full paths, e.g.
  `/opt/homebrew/opt/llvm/bin/clang-tidy` and
  `/opt/homebrew/opt/llvm/bin/clang-format`.

#### Windows

You have a few options:

1. Install the **LLVM** Windows installer from the official site.  
   It can add `clang-tidy.exe` and `clang-format.exe` to PATH automatically.

2. Use **MSYS2**:

   - Install MSYS2, then in the MSYS2 shell:

     ```bash
     pacman -S mingw-w64-x86_64-clang mingw-w64-x86_64-clang-tools-extra
     ```

   - Add the corresponding `bin` directory to PATH in Windows.

After that, ensure in **PowerShell / cmd**:

```powershell
clang-tidy --version
clang-format --version
```

---

## 3. Installation of the extension

You can either install from a packaged `.vsix` file or build from source.

### 3.1. Installing from a `.vsix` file

If you already have a `google-style-fixer-*.vsix` file:

1. Open VS Code.
2. Press `Ctrl+Shift+P` (Windows/Linux) or `Cmd+Shift+P` (macOS).
3. Type **“Extensions: Install from VSIX…”** and select it.
4. Choose your `.vsix` file.
5. Reload VS Code when prompted.

The commands will then be available:

- **Fix C++ Google Style in Workspace without hard renaming**
- **Fix C++ Google Style in Current File**

### 3.2. Build and install from source

1. Clone the repository:

   ```bash
   git clone https://github.com/shachenkovakate/VSCode-extension.git
   cd VSCode-extension
   ```

2. Install dependencies:

   ```bash
   npm install
   ```

3. Compile the extension:

   ```bash
   npm run compile
   ```

   This runs `tsc` and builds `out/extension.js`.

4. Package the extension using `vsce` (VS Code Extension Manager).  
   If you do not have it yet, install it globally:

   ```bash
   npm install -g @vscode/vsce
   ```

   Then package:

   ```bash
   vsce package
   ```

   This creates a file like `google-style-fixer-0.0.7.vsix` in the current
   directory.

5. Install the generated `.vsix` into VS Code:

   - Use **“Extensions: Install from VSIX…”** from the Command Palette,  
     or
   - Run from a terminal:

     ```bash
     code --install-extension google-style-fixer-0.0.7.vsix
     ```

   (If `code` is not in your PATH on Windows, use *“Shell Command: Install 'code' command in PATH”* from VS Code’s Command Palette.)

---

## 4. Basic usage

### 4.1. Fix the entire workspace (without renaming identifiers)

Use this when you want to clean up the style of **all** C/C++ files in the
project, but do **not** want any automatic renaming of functions/variables.

1. Open your project folder in VS Code.
2. Press `Ctrl+Shift+P` / `Cmd+Shift+P`.
3. Run:

   **“Fix C++ Google Style in Workspace without hard renaming”**

The extension will:

- collect files matching `googleStyleFixer.fileGlobs` (by default
  `**/*.{c,cc,cpp,cxx,h,hh,hpp,hxx,ixx}`) and skip those that match
  `googleStyleFixer.excludeGlobs` (by default `**/{build,out,.git,.vscode}/**`),
- run `clang-tidy -fix -fix-errors` on each file with a temporary config that
  disables `readability-identifier-naming` but inherits the rest from your
  `.clang-tidy`,
- **scan each file for common `std::...` usages (streams, containers, strings, etc.) and add
  missing standard `#include <...>` directives** into the block of system includes,
  keeping all `#include <...>` above any `#include "..."`,
- run `clang-format -i` on each file.

Changes are applied **once**. Nothing continues to auto-format in the background.

### 4.2. Fix the current file (with safe renaming)

Use this when you are actively editing a file and want to:

- rename identifiers to match your naming rules, and
- then clean up the rest of the style issues.

1. Open a C/C++ file in VS Code.
2. Press `Ctrl+Shift+P` / `Cmd+Shift+P`.
3. Run:

   **“Fix C++ Google Style in Current File”**

The extension will:

1. Save the current file.
2. Run `clang-tidy` **without `-fix`** to collect
   `readability-identifier-naming` warnings for this file.
3. For each naming diagnostic in this file:
   - infer the target name according to the following scheme:
     - **Functions / methods** → `PascalCase`, e.g. `Popcount`, `DoSomethingNice`.
     - **Constants (including enum constants)** → `kPascalCase`,
       e.g. `kMaxSize`, `kDefaultTimeout`.
     - **Variables / parameters / members / namespaces** → `lower_snake_case`,
       e.g. `value_count`, `buffer_size`, `member_` (private member suffix comes
       from your `.clang-tidy` config).
   - call VS Code’s built-in rename provider
     (`vscode.executeDocumentRenameProvider`) at that position.
   - this updates all declarations and uses across the project in the same way
     as manual *Rename Symbol*.
4. After that, run `clang-tidy -fix -fix-errors` with a temporary config that
   disables `readability-identifier-naming` (so clang-tidy won’t attempt its
   own renames on top of ours).
5. Finally, run `clang-format -i` on the file and save it.

If no safe renames can be applied (for example, the language server cannot
rename something), the extension reports that and still runs tidy+format.

Note: the **current-file** command intentionally does **not** add or reorder
`#include` directives by itself — this is handled in the workspace command,
after which `clang-format` can keep include blocks consistent.

---

## 5. Configuration in VS Code

All settings live under the `googleStyleFixer.*` namespace.

You can edit them via:

- **File → Preferences → Settings** (or `Ctrl+,`),
- search for “Google C++ Style Fixer”, or
- edit your `settings.json` directly.

### 5.1. Settings

#### `googleStyleFixer.clangTidyPath` (string)

- Default: `"clang-tidy"`
- Description: Path to the `clang-tidy` binary.
- Example values:
  - Linux: `"clang-tidy"`
  - macOS: `"/opt/homebrew/opt/llvm/bin/clang-tidy"`
  - Windows: `"C:\\Program Files\\LLVM\\bin\\clang-tidy.exe"`

#### `googleStyleFixer.clangFormatPath` (string)

- Default: `"clang-format"`
- Description: Path to the `clang-format` binary.
- Example values:
  - Linux: `"clang-format"`
  - macOS: `"/opt/homebrew/opt/llvm/bin/clang-format"`
  - Windows: `"C\\Program Files\\LLVM\\bin\\clang-format.exe"`

#### `googleStyleFixer.buildDir` (string)

- Default: `""` (empty)
- Description: Directory containing `compile_commands.json` relative to the
  workspace folder (for example `"build"`). If empty, `clang-tidy` runs
  **without** `-p=...`.

Typical CMake flow:

```bash
cmake -S . -B build -DCMAKE_EXPORT_COMPILE_COMMANDS=ON
cmake --build build
```

This creates `build/compile_commands.json`. Then set:

```jsonc
"googleStyleFixer.buildDir": "build"
```

If you use a different build directory name, change `buildDir` accordingly.

#### `googleStyleFixer.fileGlobs` (string[])

- Default: `["**/*.{c,cc,cpp,cxx,h,hh,hpp,hxx,ixx}"]`
- Description: Glob patterns for C/C++ files to process in workspace mode.

You can customize this, for example, to include only a `src` directory:

```jsonc
"googleStyleFixer.fileGlobs": [
  "src/**/*.{c,cc,cpp,cxx,h,hh,hpp,hxx,ixx}"
]
```

#### `googleStyleFixer.excludeGlobs` (string[])

- Default: `["**/{build,out,.git,.vscode}/**"]`
- Description: Glob patterns to exclude from workspace processing.

If you have additional generated directories, add them here:

```jsonc
"googleStyleFixer.excludeGlobs": [
  "**/{build,out,.git,.vscode,third_party}/**"
]
```

#### `googleStyleFixer.gitDiffBase` (string)

> **Note:** currently not used by the extension code, but reserved for a future
> “changed-files only” mode.

- Default: `""`
- Intended meaning: base revision for `git diff` (for example `"origin/master"`).

---

## 6. Recommended clang-format configuration

The extension respects your existing `.clang-format`.  
A sample configuration, tuned to be close to Google style but with **tabs of
width 4** and some stricter rules, could look like this:

```yaml
BasedOnStyle: Google
IndentWidth: 4
TabWidth: 4
UseTab: Always
ColumnLimit: 200
DerivePointerAlignment: false
PointerAlignment: Left
AllowShortIfStatementsOnASingleLine: Never
AllowShortLoopsOnASingleLine: false
AllowShortFunctionsOnASingleLine: None
BreakBeforeBraces: Attach
```

Place this in:

- your project root as `.clang-format`, or
- your home directory (for a global default), e.g.
  - Linux/macOS: `~/.clang-format`
  - Windows: `C:\\Users\\YourName\\.clang-format`

The extension simply calls `clang-format -i`. All formatting decisions are made
by your `clang-format` version + this file.

---

## 7. Recommended clang-tidy configuration

The extension also respects your `.clang-tidy`.  
Here is an example tuned for Google-like style, with explicit naming rules and
braces rules:

```yaml
Checks: >
  -*,
  bugprone-*,
  google-*,
  -google-readability-casting,
  modernize-*,
  -modernize-use-trailing-return-type,
  performance-*,
  readability-braces-around-statements,
  readability-identifier-naming

WarningsAsErrors: ''

CheckOptions:
  # Braces around all single-line statements under if/for/while/etc.
  - key:             readability-braces-around-statements.ShortStatementLines
    value:           '0'

  # Naming under Google-like style

  - key:             readability-identifier-naming.NamespaceCase
    value:           lower_case

  - key:             readability-identifier-naming.ClassCase
    value:           CamelCase
  - key:             readability-identifier-naming.StructCase
    value:           CamelCase
  - key:             readability-identifier-naming.EnumCase
    value:           CamelCase

  - key:             readability-identifier-naming.FunctionCase
    value:           CamelCase
  - key:             readability-identifier-naming.MemberFunctionCase
    value:           CamelCase

  # Regular variables: lower_case_with_underscores
  - key:             readability-identifier-naming.VariableCase
    value:           lower_case
  - key:             readability-identifier-naming.ParameterCase
    value:           lower_case
  - key:             readability-identifier-naming.LocalVariableCase
    value:           lower_case

  # Class members: lower_case with trailing underscore for private members
  - key:             readability-identifier-naming.MemberCase
    value:           lower_case
  - key:             readability-identifier-naming.PrivateMemberSuffix
    value:           _

  # Constants with k prefix and CamelCase
  - key:             readability-identifier-naming.ConstantCase
    value:           CamelCase
  - key:             readability-identifier-naming.ConstantPrefix
    value:           k
  - key:             readability-identifier-naming.EnumConstantCase
    value:           CamelCase
  - key:             readability-identifier-naming.EnumConstantPrefix
    value:           k
```

Place this file as `.clang-tidy` in your project root or home directory.

### Important interaction with the extension

- In **workspace mode**, the extension runs `clang-tidy` with an extra
  temporary `-config` that **disables only** `readability-identifier-naming`
  but inherits everything else. It then scans each file and automatically adds
  missing standard includes, and only after that calls `clang-format`.
- In **current file mode**, the extension:
  - first runs `clang-tidy` **without** overrides and **without** `-fix` to
    retrieve naming diagnostics;
  - uses its own renaming logic via the language server;
  - then runs `clang-tidy -fix` again **with** naming disabled, to avoid
    double-changes to identifiers;
  - finally runs `clang-format`.

This way you keep precise control over when and how names are changed, while
still getting auto-added standard includes in workspace mode.

---

## 8. Troubleshooting

### 8.1. “clang-tidy not found” / “clang-format not found”

- Make sure they are installed and available in your PATH.
- If they are in a non-standard directory, set the full path in:

  ```jsonc
  "googleStyleFixer.clangTidyPath": "/full/path/to/clang-tidy",
  "googleStyleFixer.clangFormatPath": "/full/path/to/clang-format"
  ```

### 8.2. “No workspace folder is open.”

The extension works on **workspace folders**, not on single loose files.

- Use **File → Open Folder…** (or “Open Workspace”) and open the project
  directory.
- Then run the commands again.

### 8.3. “No C/C++ files to process.”

- Check that your files match the `googleStyleFixer.fileGlobs` patterns.
- Make sure they are not under directories filtered out by
  `googleStyleFixer.excludeGlobs`.

### 8.4. Naming is not updated in current file

Possible reasons:

1. `clang-tidy` does not emit `readability-identifier-naming` warnings for that
   identifier (check your `.clang-tidy` rules).
2. The language server (C/C++ or clangd) cannot perform Rename Symbol for this
   symbol (for example, if the project is not fully configured / not indexed
   yet).
3. The inferred target name happens to be identical to the current one (the
   extension then skips renaming).

### 8.5. “No safe renames applied.”

This is not an error. It means that either:

- there were no naming violations, or
- all potential renames failed the safety checks (e.g. the rename provider
  returned no edit).

In both cases, the extension still runs `clang-tidy -fix` with naming disabled
and `clang-format` for the rest of the style.

---

## 9. Customization

If you want to customize or extend this extension, you can:

- modify `extension.ts` (TypeScript source),
- re-run `npm run compile`,
- package a new `.vsix` with `vsce package`,
- install it in your own VS Code.

Happy formatting!